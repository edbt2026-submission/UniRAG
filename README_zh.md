# UniRAG é¡¹ç›®è¯´æ˜Ž ðŸš€

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºŽçŸ¥è¯†å›¾è°±çš„æ£€ç´¢å¢žå¼ºç”Ÿæˆ (RAG) æ¡†æž¶ã€‚å®ƒé€šè¿‡ä¸€ç³»åˆ—ç²¾ç»†çš„æ­¥éª¤ï¼Œå°†åŽŸå§‹æ–‡æœ¬æ–‡æ¡£å¤„ç†ã€åˆ†æžã€å¹¶æž„å»ºæˆä¸€ä¸ª Neo4j çŸ¥è¯†å›¾è°±ã€‚æœ€ç»ˆç»“åˆå‘é‡æ•°æ®åº“ Faissï¼Œå®žçŽ°é«˜è´¨é‡çš„é—®ç­”ã€‚

ç›¸è¾ƒäºŽä¼ ç»Ÿçš„æœ´ç´  RAGï¼Œæœ¬é¡¹ç›®çš„ä¼˜åŠ¿åœ¨äºŽåˆ©ç”¨çŸ¥è¯†å›¾è°±è¿›è¡Œæ·±åº¦çš„å…³è”æ€§æ£€ç´¢ï¼Œå³ä½¿åœ¨ä½¿ç”¨è¾ƒå°å‚æ•°é‡çš„è¯­è¨€æ¨¡åž‹ï¼ˆå¦‚ Qwen2.5-7B-Instructï¼‰æ—¶ï¼Œä¹Ÿèƒ½èŽ·å¾—æ˜¾è‘—ä¼˜äºŽä¼ ç»Ÿ RAG çš„å›žç­”è´¨é‡ã€‚

---

## ðŸ“š ç›®å½•

* [çŽ¯å¢ƒå®‰è£…](#-çŽ¯å¢ƒå®‰è£…-installation)
* [ä½¿ç”¨æµç¨‹](#-ä½¿ç”¨æµç¨‹-workflow)
* [é¡¹ç›®ç»“æž„ï¼ˆå¯é€‰ï¼‰](#-é¡¹ç›®ç»“æž„-å¯é€‰)

---

## ðŸ› ï¸ çŽ¯å¢ƒå®‰è£… (Installation)

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£… **Python (æŽ¨è 3.10)**ã€**Anaconda (æˆ– Miniconda)** ä»¥åŠ **Neo4j æ•°æ®åº“**ã€‚

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/edbt2026-submission/UniRAG.git
```

### 2. åˆ›å»ºå¹¶æ¿€æ´» Conda çŽ¯å¢ƒ

æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ Conda æ¥ç®¡ç†é¡¹ç›®çŽ¯å¢ƒï¼Œä»¥é¿å…åŒ…ç‰ˆæœ¬å†²çªã€‚

```bash
# åˆ›å»ºä¸€ä¸ªåä¸º UniRAG çš„æ–°çŽ¯å¢ƒï¼Œå¹¶æŒ‡å®š Python ç‰ˆæœ¬
conda create -n UniRAG python=3.10

# æ¿€æ´»è¯¥çŽ¯å¢ƒ
conda activate UniRAG
```

### 3. å®‰è£…ä¾èµ–

é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹éƒ½å·²è®°å½•åœ¨ `requirements.txt` æ–‡ä»¶ä¸­ã€‚

```bash
# ä½¿ç”¨ pip å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt
```

### 4. é…ç½® Neo4j æ•°æ®åº“

åœ¨å¼€å§‹æž„å»ºå›¾è°±ä¹‹å‰ï¼Œæ‚¨éœ€è¦ç¡®ä¿ Neo4j æœåŠ¡å·²å¯åŠ¨ï¼Œå¹¶æ­£ç¡®é…ç½®è¿žæŽ¥ä¿¡æ¯ã€‚

> **é‡è¦æç¤º**:
> è¯·æ‰“å¼€ `Neo4j_tools.py` æ–‡ä»¶ï¼Œæ ¹æ®æ‚¨æœ¬åœ° Neo4j æ•°æ®åº“çš„å®žé™…æƒ…å†µï¼Œä¿®æ”¹ä»¥ä¸‹è¿žæŽ¥é…ç½®ï¼š
> * URI (ä¾‹å¦‚: "bolt://localhost:7687")
> * ç”¨æˆ·å (ä¾‹å¦‚: "neo4j")
> * å¯†ç  (ä¾‹å¦‚: "your_password")

---

### 5. é…ç½® API_KEY

åœ¨åˆæ¬¡æž„å»ºæ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å°æ–‡æœ¬æ”¾åœ¨å¯¹åº”ç›®å½•ä¸‹ï¼Œå¡«å†™LLMå¹³å°çš„API_KEYä¿¡æ¯è¿›è¡Œä½¿ç”¨ï¼Œä¾‹å¦‚deepseekï¼Œæˆ–æ˜¯siliconã€‚

## ðŸš€ ä½¿ç”¨æµç¨‹ (Workflow)

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é¡ºåºæ‰§è¡Œè„šæœ¬ï¼Œä»¥ç¡®ä¿æ•°æ®å¤„ç†æµç¨‹çš„æ­£ç¡®æ€§ã€‚

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ–‡ä»¶

1.  å°†æ‚¨éœ€è¦å¤„ç†çš„ `.txt` æ ¼å¼çš„åŽŸå§‹æ–‡æœ¬æ–‡æ¡£æ”¾ç½®åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ã€‚

### ç¬¬äºŒæ­¥ï¼šæ–‡æœ¬å¤„ç†ä¸ŽèŠ‚ç‚¹èžåˆ

æ­¤é˜¶æ®µè´Ÿè´£å°†åŽŸå§‹æ–‡æœ¬æ‹†åˆ†ã€åˆ†æžã€æŠ½å–å®žä½“ï¼Œå¹¶è¿›è¡Œåˆæ­¥çš„èŠ‚ç‚¹èžåˆã€‚

1.  **æ–‡æ¡£æ‹†åˆ†**:
    * è¿è¡Œè„šæœ¬: `python step0-0-æ–‡æ¡£æ‹†åˆ†å™¨.py`
    * **ä½œç”¨**: å°†æ•´ä¸ªæ–‡æ¡£åˆ‡åˆ†æˆæ›´å°çš„ã€æ˜“äºŽå¤„ç†çš„æ–‡æœ¬å—ã€‚

2.  **æ–‡æ®µåˆ†æžä¸Žå®žä½“æŠ½å–**:
    * è¿è¡Œè„šæœ¬: `python step0-1-0-æ–‡æ®µåˆ†æž.py`
    * **æ³¨æ„**:
        * æ­¤æ­¥éª¤ä¾èµ– DeepSeek çš„å®˜æ–¹ API è¿›è¡Œå®žä½“å’Œå…³ç³»çš„æŠ½å–ã€‚è¯·ç¡®ä¿æ‚¨å·²é…ç½®å¥½ç›¸å…³ API Keyã€‚
        * åœ¨ä»£ç ä¸­ï¼Œè¯·æ ¹æ®éœ€è¦è§£é™¤ `analyze_text_large` å‡½æ•°çš„æ³¨é‡Šã€‚

3.  **æ£€æŸ¥å¹¶æ¸…æ´—åˆ†æžç»“æžœ**:
    * è¿è¡Œè„šæœ¬: `python step0-1-1-é¢å¤–è½¬æ¢.py`
    * **ä½œç”¨**: æ­¤è„šæœ¬ä¼šéªŒè¯ä¸Šä¸€æ­¥ç”Ÿæˆçš„ JSON ç»“æžœæ˜¯å¦åˆæ³•ã€‚
        * å®ƒä¼šå°†æŠ½å–ç»“æžœä¸­æ ¼å¼é”™è¯¯çš„æ¡ç›®åˆ é™¤ï¼Œå¹¶ç”Ÿæˆ `{filename}_extract_result.jsonl` æ–‡ä»¶ã€‚
        * **è¯·æ£€æŸ¥æ­¤è„šæœ¬çš„è¾“å‡º**ã€‚å¦‚æžœæç¤ºæœ‰é”™è¯¯æ¡ç›®è¢«åˆ é™¤ï¼Œæ‚¨éœ€è¦**é‡æ–°è¿è¡Œ `step0-1-0-æ–‡æ®µåˆ†æž.py`** æ¥è¡¥å……ç¼ºå¤±çš„æ•°æ®ã€‚
        * æœ€ç»ˆï¼Œè¯·ç¡®ä¿ `{filename}_extract_result.jsonl` æ–‡ä»¶ä¸­çš„ `entities` å­—æ®µéƒ½å·²æˆåŠŸè½¬æ¢ä¸ºå­—å…¸æ ¼å¼ã€‚

4.  **æ ¼å¼è½¬æ¢**:
    * è¿è¡Œè„šæœ¬: `python step0-2-ç»“ç‚¹æ–‡ä»¶è½¬æ¢.py`
    * **ä½œç”¨**: å°†åˆ†æžç»“æžœè½¬æ¢ä¸ºå‡†å¤‡è¿›è¡ŒèŠ‚ç‚¹èžåˆçš„ä¸­é—´æ ¼å¼ï¼Œå¹¶ä¿å­˜åœ¨ `{filename}_EX.jsonl` æ–‡ä»¶ä¸­ã€‚

5.  **å±€éƒ¨èŠ‚ç‚¹èžåˆ**:
    * è¿è¡Œè„šæœ¬: `python step2_0_go_merge.py`
    * **ä½œç”¨**: æ ¹æ®å®žä½“é—´çš„å…³ç³»è¿›è¡Œåˆæ­¥çš„èžåˆè®¡ç®—ã€‚
    * **æ³¨æ„**: æ­¤æ­¥éª¤è®¡ç®—é‡è¾ƒå¤§ï¼Œè¿è¡Œæ—¶é—´å¯èƒ½è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚ç»“æžœä¿å­˜åœ¨ `{filename}_merge.jsonl` ä¸­ã€‚

6.  **èžåˆç»“æžœåˆæ³•æ€§éªŒè¯**:
    * è¿è¡Œè„šæœ¬: `python step2-1-éªŒè¯mergeåˆæ³•æ€§.py`
    * **ä½œç”¨**: æŽ’é™¤ä¸Šä¸€é˜¶æ®µä¸­å¯èƒ½äº§ç”Ÿçš„ä¸åˆæ³•èžåˆï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆç‰ˆçš„ `{filename}_final_merge.jsonl`ã€‚

7.  **åˆ›å»ºèžåˆç´¢å¼•**:
    * è¿è¡Œè„šæœ¬: `python step2-2-ç»“ç‚¹èžåˆ.py`
    * **ä½œç”¨**: ä¸ºèžåˆåŽçš„èŠ‚ç‚¹åˆ›å»ºç´¢å¼•ï¼Œå‡†å¤‡å†™å…¥å›¾æ•°æ®åº“ã€‚ç»“æžœä¿å­˜åœ¨ `{filename}_EX_pro.jsonl` ä¸­ã€‚

### ç¬¬ä¸‰æ­¥ï¼šNeo4j å›¾è°±æž„å»º

æ­¤é˜¶æ®µå°†å¤„ç†å¥½çš„æ•°æ®æ­£å¼å†™å…¥ Neo4j æ•°æ®åº“ï¼Œå¹¶è¿›è¡Œå›¾å±‚é¢çš„èžåˆã€‚

1.  **èŠ‚ç‚¹å…¥åº“**:
    * è¿è¡Œè„šæœ¬: `python step3-0-ç»“ç‚¹å…¥Neo4j.py`
    * **ä½œç”¨**: å°†æ‰€æœ‰åŸºç¡€èŠ‚ç‚¹æ•°æ®å†™å…¥ Neo4jã€‚è¿è¡ŒåŽå¯ç™»å½• Neo4j Browser æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦åˆ›å»ºæˆåŠŸã€‚
    * **å·¥å…·**: åŒæ–‡ä»¶å¤¹ä¸‹çš„ `DeleteALL.py` å¯ç”¨äºŽä¸€é”®æ¸…ç©ºæ•°æ®åº“ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚

2.  **å±€éƒ¨èžåˆå…³ç³»ç”Ÿæˆ**:
    * è¿è¡Œè„šæœ¬: `python step3-1-å±€éƒ¨èžåˆ.py`
    * **ä½œç”¨**: åœ¨æœ¬åœ°è®¡ç®—å¹¶ç”Ÿæˆéœ€è¦è¿›è¡Œèžåˆçš„å®žä½“ç»„åˆ—è¡¨ (`{filename}_group_fusion.jsonl`)ã€‚

3.  **å±€éƒ¨èžåˆå…³ç³»å…¥åº“**:
    * è¿è¡Œè„šæœ¬: `python step3-2-å±€éƒ¨èžåˆå†™è¿›Neo4j.py`
    * **ä½œç”¨**: å°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„èžåˆå…³ç³»å†™å…¥ Neo4jï¼Œä¸º `Group` ç±»åž‹çš„èŠ‚ç‚¹æ·»åŠ å±žæ€§ã€‚

4.  **å…¨å±€èžåˆå…³ç³»è®¡ç®—**:
    * è¿è¡Œè„šæœ¬: `python step3-3-å…¨å±€èžåˆ.py`
    * **ä½œç”¨**: åœ¨æ•´ä¸ªå›¾è°±å±‚é¢è¿›è¡Œè·¨å®žä½“ç»„çš„å…¨å±€èžåˆè®¡ç®—ï¼Œç”Ÿæˆ `_group_before_global.jsonl` æ–‡ä»¶ã€‚

5.  **å…¨å±€èžåˆå…³ç³»å…¥åº“**:
    * è¿è¡Œè„šæœ¬: `python step3-4-å…¨å±€èžåˆå†™è¿›Neo4j.py`
    * **ä½œç”¨**: å°†å…¨å±€èžåˆå…³ç³»å†™å…¥ Neo4jï¼Œå®Œæˆå›¾è°±çš„æœ€ç»ˆæž„å»ºã€‚

### ç¬¬å››æ­¥ï¼šå‘é‡åŒ–ä¸Žé—®ç­”

æ­¤é˜¶æ®µä¸ºå›¾è°±ä¸­çš„çŸ¥è¯†åˆ›å»ºå‘é‡ç´¢å¼•ï¼Œå¹¶å¯åŠ¨é—®ç­”ç¨‹åºã€‚

1.  **æ–‡æœ¬å‘é‡åŒ–**:
    * è¿è¡Œè„šæœ¬: `python step-4-1-Embedding.py`
    * **ä½œç”¨**: å°†å›¾è°±ä¸­çš„èŠ‚ç‚¹æ–‡æœ¬å†…å®¹è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºã€‚

2.  **æž„å»º Faiss å‘é‡ç´¢å¼•**:
    * è¿è¡Œè„šæœ¬: `python step-4-2-Faiss.py`
    * **ä½œç”¨**: ä½¿ç”¨ Faiss æž„å»ºé«˜æ•ˆçš„æœ¬åœ°å‘é‡æ•°æ®åº“ç´¢å¼•ï¼Œç”¨äºŽå¿«é€Ÿæ£€ç´¢ã€‚

3.  **å¼€å§‹é—®ç­”**:
    * è¿è¡Œä¸»ç¨‹åº: `python QA.py`
    * **é…ç½®**: æ‚¨å¯ä»¥åœ¨ `QA.py` æ–‡ä»¶çš„ `main` å‡½æ•°ä¸­ä¿®æ”¹å’Œé…ç½®é—®ç­”çš„ç›¸å…³å‚æ•°å’Œå‘½ä»¤ã€‚

---

## ðŸ“‚ é¡¹ç›®ç»“æž„

```
.
â”œâ”€â”€ UniRAG/
â”‚   â”œâ”€â”€ step0-0-æ–‡æ¡£æ‹†åˆ†å™¨.py
â”‚   â”œâ”€â”€ step0-1-0-æ–‡æ®µåˆ†æž.py
â”‚   â”œâ”€â”€ step0-1-1-é¢å¤–è½¬æ¢.py
â”‚   â”œâ”€â”€ ... (å…¶ä»–æ‰€æœ‰pyè„šæœ¬)
â”‚   â”œâ”€â”€ Neo4j_tools.py
â”‚   â””â”€â”€ QA.py
â”œâ”€â”€ your_document.txt
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```
> 